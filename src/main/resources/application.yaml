server:
  port: ${PORT:8080}
  address: 0.0.0.0

spring:
  datasource:
    url: jdbc:mysql://${MYSQLHOST}:${MYSQLPORT}/${MYSQLDATABASE}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&enabledTLSProtocols=TLSv1.2
    username: ${MYSQLUSER:EMKAY}
    password: ${MYSQLPASSWORD:mikel2006@}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 5  # Reduced from 20 to save memory
      minimum-idle: 2        # Reduced from 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: false  # Always false to reduce logging overhead
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: false  # Disabled to save memory
        use_sql_comments: false  # Disabled to save memory
    defer-datasource-initialization: true
  
  # CRITICAL: Enable lazy initialization to reduce startup memory
  main:
    lazy-initialization: true

  servlet:
    multipart:
      enabled: true  
      max-file-size: 500MB
      max-request-size: 500MB

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:qualitestmedical@gmail.com}
    password: ${MAIL_PASSWORD:qmlwmmjrtkczfgyc}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

jwt:
  secret: ${JWT_SECRET:MedicalAppSecretKeyForauthTokenGeneration2024ChangeThisInProduction}
  expiration: ${JWT_EXPIRATION:86400000}

app:
  file:
    upload-dir: uploads/results
    export-dir: uploads/exports
    max-size: 500MB

  support:
    business-hours:
      start: "09:00"
      end: "18:00"
    ticket-daily-limit: 5
    response-time: "4-6 hours"
    emergency-contact: "+234-XXX-XXXX"

  export:
    storage-dir: exports
    max-file-size: 500MB
    retention-days: 7
    allowed-formats: JSON,XML,CSV,FHIR,PDF

  security:
    cors:
      allowed-origins: ${CORS_ORIGINS:https://qualitest-admin-jjb2y3eqk-akapomicheal2006-6545s-projects.vercel.app,https://qualitest-admin.vercel.app,http://localhost:3000,http://localhost:5173,http://localhost:8000,http://localhost:8081}
      allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH,HEAD
      allowed-headers: Authorization,Content-Type,Accept,Origin,X-Requested-With,Access-Control-Request-Method,Access-Control-Request-Headers
      allow-credentials: true
      max-age: 3600
    
  notification:
    sms:
      enabled: true
      provider: "twilio"
      api-key: ${SMS_API_KEY:}
    email:
      enabled: true
      from: "noreply@medicalapp.com"
    push:
      enabled: true

# Reduced logging to save memory
logging:
  level:
    com.medicalapp.medical_app_backend: INFO  # Changed from DEBUG
    org.springframework.security: WARN        # Changed from DEBUG
    org.springframework.web: WARN             # Changed from DEBUG
    org.springframework.web.cors: WARN        # Changed from DEBUG
    org.hibernate.SQL: ERROR                  # Changed from WARN
    org.hibernate.type.descriptor.sql.BasicBinder: ERROR
  pattern:
    console: "%d{HH:mm:ss} - %msg%n"  # Simplified pattern

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

---
spring:
  config:
    activate:
      on-profile: production

  datasource:
    url: jdbc:mysql://${MYSQLHOST}:${MYSQLPORT}/${MYSQLDATABASE}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&enabledTLSProtocols=TLSv1.2
    username: ${MYSQLUSER}
    password: ${MYSQLPASSWORD}
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
  
  main:
    lazy-initialization: true

logging:
  level:
    com.medicalapp.medical_app_backend: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN

app:
  security:
    cors:
      allowed-origins: ${CORS_ORIGINS:https://qualitest-admin-jjb2y3eqk-akapomicheal2006-6545s-projects.vercel.app,https://qualitest-admin.vercel.app}
      allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH,HEAD
      allowed-headers: Authorization,Content-Type,Accept,Origin,X-Requested-With,Access-Control-Request-Method,Access-Control-Request-Headers
      allow-credentials: true
      max-age: 3600